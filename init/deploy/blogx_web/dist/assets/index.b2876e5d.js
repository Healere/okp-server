import{_ as J,F as P}from"./f_main.de2a37c7.js";import{M as G}from"./index.3082d1cd.js";/* empty css                */import{l as H,m as Q,h as W,n as X}from"./article_api.d25b0d15.js";import{d as O,q as M,a as z,b as U,r as v,o as c,c as h,w as y,f as d,h as t,e as D,g as N,m as A,t as g,i as $,F as R,M as u,n as V,u as l,ai as Y,z as Z,k as q,l as tt,a8 as et,ap as ot,j as nt,J as st,D as S,s as j}from"./index.b57f2f57.js";import{d as it,a as at}from"./date.5a421098.js";import{_ as lt,c as ct}from"./f_collect_form_modal.vue_vue_type_script_setup_true_lang.83acb97e.js";import{c as K,d as ut,b as rt,e as dt}from"./comment_api.9cd7d251.js";import{_ as mt,a as _t}from"./options.22e943c4.js";import{g as L,b as pt}from"./go_router.d8eedbce.js";import{M as ft}from"./index3.081a6306.js";import"./f_theme.vue_vue_type_script_setup_true_lang.c42e8a1a.js";import"./_plugin-vue_export-helper.cdc0426e.js";const gt={class:"list"},vt={class:"item"},Ct={class:"left"},yt={class:"title"},kt={class:"count"},Dt=O({__name:"f_article_collect_modal",props:{visible:{type:Boolean},articleId:{}},emits:["update:visible","select"],setup(T,{emit:w}){const p=M(),r=T,e=w,m=z({list:[],count:0});function C(){e("update:visible",!1)}async function k(){m.list=[],m.count=0;const _=await ct({type:1,articleID:r.articleId});if(_.code){u.error(_.msg);return}Object.assign(m,_.data),m.list.length===0&&m.list.push({id:0,createdAt:"",updatedAt:"",title:"\u9ED8\u8BA4\u6536\u85CF\u5939",abstract:"",cover:"",userID:p.userInfo.userID,isDefault:!0,articleCount:0,articleUse:!1})}z({});const B=U("");function x(){n.value=!0}const n=U(!1);function s(_){e("select",_.id),C()}return(_,f)=>{const E=v("a-tag"),b=v("a-button"),a=v("a-modal");return c(),h(a,{footer:!1,"body-class":"collect_modal_body scrollbar",title:"\u6536\u85CF\u6587\u7AE0",onBeforeOpen:k,onCancel:C,visible:r.visible},{default:y(()=>[d(lt,{title:B.value,"onUpdate:title":f[0]||(f[0]=o=>B.value=o),visible:n.value,"onUpdate:visible":f[1]||(f[1]=o=>n.value=o),onOk:k},null,8,["title","visible"]),t("div",{class:"add"},[t("div",{class:"inner",onClick:x},f[2]||(f[2]=[t("i",{class:"iconfont icon-jia"},null,-1),t("span",null,"\u521B\u5EFA\u6536\u85CF\u5939",-1)]))]),t("div",gt,[(c(!0),D(R,null,N(m.list,o=>(c(),D("div",vt,[t("div",Ct,[t("div",yt,[A(g(o.title)+" ",1),o.isDefault?(c(),h(E,{key:0,color:"blue"},{default:y(()=>f[3]||(f[3]=[A("\u9ED8\u8BA4\u6536\u85CF\u5939")])),_:1})):$("",!0)]),t("div",kt,g(o.articleCount)+"\u7BC7\u6587\u7AE0",1)]),d(b,{onClick:i=>s(o),type:"primary",status:o.articleUse?"danger":"",size:"mini"},{default:y(()=>[A(g(o.articleUse?"\u53D6\u6D88\u6536\u85CF":"\u6536\u85CF"),1)]),_:2},1032,["onClick","status"])]))),256))])]),_:1},8,["visible"])}}});const Bt=["onClick"],bt=["onClick"],Ft={key:0,class:"action"},It=["onClick"],At={key:0,class:"apply_comment"},Et=O({__name:"comment_tree",props:{list:{},line:{}},emits:["ok"],setup(T,{emit:w}){const p=M(),r=w,e=T;function m(n){n.isApply=!n.isApply,n.isApply&&Z(()=>{document.querySelector(`.apply_comment_ipt_${n.id} input`).focus()})}async function C(n){var _;if(((_=n.applyContent)==null?void 0:_.trim())===""){u.warning("\u8BF7\u8F93\u5165\u56DE\u590D\u5185\u5BB9");return}const s=await K({content:n.applyContent,articleID:n.articleID,parentID:n.id});if(s.code){u.error(s.msg);return}u.success(s.msg),r("ok")}function k(){r("ok")}async function B(n){const s=await ut(n.id);if(s.code){u.error(s.msg);return}u.success(s.msg),n.isDigg=!n.isDigg,n.isDigg?n.diggCount++:n.diggCount--}async function x(n){const s=await rt(n.id);if(s.code){u.error(s.msg);return}u.success(s.msg),r("ok")}return(n,s)=>{const _=v("a-popconfirm"),f=v("a-avatar"),E=v("a-input"),b=v("a-button"),a=v("comment_tree",!0),o=v("a-comment");return c(!0),D(R,null,N(e.list,i=>(c(),h(o,{class:"comment_tree_com",content:i.content,datetime:l(it)(i.createdAt)},{actions:y(()=>[t("span",{class:V(["action",{active:i.isDigg}]),onClick:F=>B(i)},[s[0]||(s[0]=t("i",{class:"iconfont icon-dianzan_kuai"},null,-1)),A(" \u70B9\u8D5E\uFF08"+g(i.diggCount)+"\uFF09 ",1)],10,Bt),e.line!=l(p).siteInfo.article.commentLine?(c(),D("span",{key:0,class:"action",onClick:F=>m(i)},[s[1]||(s[1]=t("i",{class:"iconfont icon-pinglun1"},null,-1)),A(" \u56DE\u590D\uFF08"+g(i.applyCount)+"\uFF09 ",1)],8,bt)):$("",!0),d(_,{content:"\u786E\u5B9A\u8981\u5220\u9664\u6B64\u8BC4\u8BBA\u5417\uFF1F",onOk:F=>x(i)},{default:y(()=>[i.userID===l(p).userInfo.userID?(c(),D("span",Ft,[t("i",null,[d(l(Y))]),s[2]||(s[2]=A(" \u5220\u9664 "))])):$("",!0)]),_:2},1032,["onOk"])]),author:y(()=>[t("span",{onClick:F=>l(L)(i.userID)},g(i.userNickname),9,It),i.userID!==l(p).userInfo.userID&&i.relation!==1?(c(),h(mt,{key:0,style:{"margin-left":"10px"},options:l(_t),value:i.relation},null,8,["options","value"])):$("",!0)]),avatar:y(()=>[d(f,{onClick:F=>l(L)(i.userID),"image-url":i.userAvatar},null,8,["onClick","image-url"])]),default:y(()=>{var F;return[i.isApply?(c(),D("div",At,[d(E,{modelValue:i.applyContent,"onUpdate:modelValue":I=>i.applyContent=I,class:V(`apply_comment_ipt_${i.id}`),placeholder:`\u56DE\u590D${i.userNickname}`},null,8,["modelValue","onUpdate:modelValue","class","placeholder"]),d(b,{type:"primary",onClick:I=>C(i)},{default:y(()=>s[3]||(s[3]=[A("\u56DE\u590D")])),_:2},1032,["onClick"])])):$("",!0),(F=i.subComments)!=null&&F.length?(c(),h(a,{key:1,line:e.line+1,onOk:k,list:i.subComments},null,8,["line","list"])):$("",!0)]}),_:2},1032,["content","datetime"]))),256)}}});const $t={class:"article_comment_com"},ht={class:"add_comment"},wt={class:"comment_list"},xt={key:0,class:"page"},Tt=O({__name:"article_comment",props:{articleId:{}},setup(T,{expose:w}){const p=T,r=z({limit:10,page:1,id:0}),e=z({list:[],count:0});async function m(){r.id=p.articleId;const n=await dt(r);if(n.code){u.error(n.msg);return}e.list=n.data.list,e.count=n.data.count}const C=z({content:"",articleID:p.articleId,parentID:void 0});async function k(){if(C.articleID=p.articleId,C.content.trim()===""){u.warning("\u8BF7\u8F93\u5165\u8BC4\u8BBA\u5185\u5BB9");return}const n=await K(C);if(n.code){u.error(n.msg);return}u.success(n.msg),m(),C.content=""}q(()=>p.articleId,()=>{m()},{immediate:!0});const B=U();function x(){B.value.focus()}return w({focus:x}),(n,s)=>{const _=v("a-textarea"),f=v("a-button"),E=v("a-pagination");return c(),D("div",$t,[t("div",ht,[d(_,{modelValue:C.content,"onUpdate:modelValue":s[0]||(s[0]=b=>C.content=b),ref_key:"textareaRef",ref:B,onKeydown:tt(k,["enter"]),"auto-size":{minRows:5,maxRows:6},placeholder:"\u8BF7\u8F93\u5165\u8BC4\u8BBA\u5185\u5BB9"},null,8,["modelValue"]),d(f,{type:"primary",onClick:k,size:"mini"},{default:y(()=>s[2]||(s[2]=[A("\u53D1\u5E03\u8BC4\u8BBA")])),_:1})]),t("div",wt,[d(Et,{line:1,onOk:m,list:e.list},null,8,["list"]),e.list.length?(c(),D("div",xt,[d(E,{onChange:m,"page-size":r.limit,total:e.count,"show-total":"",current:r.page,"onUpdate:current":s[1]||(s[1]=b=>r.page=b)},null,8,["page-size","total","current"])])):$("",!0)])])}}});const zt={class:"article_detail_view"},Ut={class:"article_container"},Vt={class:"article_content"},Lt={class:"head"},Ot={class:"title"},Mt={class:"date"},Nt={class:"tags"},Rt={class:"body"},St={key:1,class:"no_comment"},jt={class:"article_info"},qt={class:"user_info"},Kt={class:"user"},Jt={class:"data"},Pt={class:"item"},Gt={class:"item"},Ht={class:"item"},Qt={class:"item"},Wt={class:"catalog"},Xt={class:"body scrollbar"},Yt={class:"article_action"},me=O({__name:"index",setup(T){const w=document.documentElement,p=M(),r=nt(),e=z({id:0,createdAt:"",updatedAt:"",title:"",abstract:"",content:"",categoryID:0,categoryTitle:"",tagList:[],cover:"",userID:0,lookCount:0,diggCount:0,commentCount:0,collectCount:0,openComment:!1,status:0,username:"",nickname:"",userAvatar:"",isDigg:!1,isCollect:!1});async function m(){const a=await W(Number(r.params.id));if(a.code){u.error(a.msg);return}Object.assign(e,a.data),setTimeout(C,2e3)}async function C(){const a=await X(e.id);if(a.code){u.error(a.msg);return}}q(()=>r.params.id,()=>{m()},{immediate:!0}),et(()=>{const a=r.query.id;setTimeout(()=>{if(a){const o=document.getElementById(a);o&&document.documentElement.scrollTo({top:o.offsetTop,behavior:"smooth"})}},500)});const k=U(!1);function B(){document.documentElement.scrollTop>=210?k.value=!0:k.value=!1}window.addEventListener("scroll",B),ot(()=>{window.removeEventListener("scroll",B)});async function x(){if(!p.isLogin){j({reload:!0});return}const a=await H(e.id);if(a.code){u.error(a.msg);return}u.success(a.msg),e.isDigg=!e.isDigg,e.isDigg?e.diggCount++:e.diggCount--}const n=U(!1);async function s(){if(!p.isLogin){j({reload:!0});return}n.value=!0}async function _(a){const o=await Q({articleID:e.id,collectID:a});if(o.code){u.error(o.msg);return}u.success(o.msg),o.msg==="\u6536\u85CF\u6210\u529F"?(e.isCollect=!0,e.collectCount++):e.collectCount--}function f(){document.documentElement.scrollTo({top:0,behavior:"smooth"})}const E=U();function b(){const o=document.querySelector(".add_comment").offsetTop;document.documentElement.scrollTo({top:o,behavior:"smooth"}),setTimeout(()=>{E.value.focus()},800)}return(a,o)=>{const i=v("a-tag"),F=v("a-avatar");return c(),D("div",zt,[d(J,{"no-scroll":""}),d(P,null,{default:y(()=>[d(Dt,{"article-id":e.id,onSelect:_,visible:n.value,"onUpdate:visible":o[0]||(o[0]=I=>n.value=I)},null,8,["article-id","visible"]),t("div",Ut,[t("div",Vt,[t("div",Lt,[t("div",Ot,[t("span",null,g(e.title),1),e.userID===l(p).userInfo.userID?(c(),h(l(st),{key:0,style:{"margin-left":"10px",cursor:"pointer"},title:"\u53BB\u7F16\u8F91",onClick:o[1]||(o[1]=I=>l(pt)(e.id))})):$("",!0)]),t("div",Mt,g(l(at)(e.createdAt)),1),t("div",Nt,[(c(!0),D(R,null,N(e.tagList,I=>(c(),h(i,null,{default:y(()=>[A(g(I),1)]),_:2},1024))),256))])]),t("div",Rt,[d(l(G),{id:`md_${e.id}`,theme:l(S),"model-value":e.content},null,8,["id","theme","model-value"])])]),e.openComment?(c(),h(Tt,{key:0,ref_key:"articleCommentRef",ref:E,"article-id":Number(l(r).params.id)},null,8,["article-id"])):(c(),D("div",St,"\u4F5C\u8005\u5DF2\u5173\u95ED\u6587\u7AE0\u8BC4\u8BBA"))]),t("div",jt,[t("div",qt,[t("div",Kt,[d(F,{onClick:o[2]||(o[2]=I=>l(L)(e.userID)),size:60,"image-url":e.userAvatar},null,8,["image-url"])]),t("div",{class:"nick",onClick:o[3]||(o[3]=I=>l(L)(e.userID))},g(e.nickname),1),t("div",Jt,[t("div",Pt,[t("span",null,g(e.lookCount),1),o[4]||(o[4]=t("span",null,[t("i",{class:"iconfont icon-liulan"})],-1))]),t("div",Gt,[t("span",null,g(e.diggCount),1),o[5]||(o[5]=t("span",null,[t("i",{class:"iconfont icon-dianzan_kuai"})],-1))]),t("div",Ht,[t("span",null,g(e.collectCount),1),o[6]||(o[6]=t("span",null,[t("i",{class:"iconfont icon-shoucang1"})],-1))]),t("div",Qt,[t("span",null,g(e.commentCount),1),o[7]||(o[7]=t("span",null,[t("i",{class:"iconfont icon-pinglun1"})],-1))])])]),t("div",{class:V(["catalog_action",{isFixed:k.value}])},[t("div",Wt,[o[8]||(o[8]=t("div",{class:"head"},"\u6587\u7AE0\u76EE\u5F55",-1)),t("div",Xt,[d(l(ft),{offsetTop:61,scrollElementOffsetTop:60,editorId:`md_${e.id}`,scrollElement:l(w),theme:l(S)},null,8,["editorId","scrollElement","theme"])])]),t("div",Yt,[t("i",{title:"\u70B9\u8D5E",onClick:x,class:V(["iconfont icon-dianzan_kuai",{active:e.isDigg}])},null,2),t("i",{title:"\u6536\u85CF",onClick:s,class:V(["iconfont icon-shoucang1",{active:e.isCollect}])},null,2),t("i",{title:"\u56DE\u5230\u9876\u90E8",onClick:f,class:"iconfont icon-zhiding"}),t("i",{title:"\u53BB\u8BC4\u8BBA",onClick:b,class:"iconfont icon-pinglun1"})])],2)])]),_:1})])}}});export{me as default};
