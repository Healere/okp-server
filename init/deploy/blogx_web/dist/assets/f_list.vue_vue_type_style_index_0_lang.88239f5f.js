import{c as oe}from"./date.5a421098.js";import{d as te,b as k,a as M,r as u,o as l,c,w as d,M as F,y as C,f as v,e as f,g as Z,F as S,i as g,h as U,u as A,aC as he,aD as be,aE as ge,m as N,t as O,O as ke,aF as V}from"./index.b57f2f57.js";import{_ as we}from"./options.22e943c4.js";const Ve=te({__name:"f_modal_form",props:{visible:{type:Boolean},formList:{},addLabel:{},editLabel:{}},emits:["update:visible","create","update"],setup(q,{expose:H,emit:J}){const s=q,$=k([]);async function Q(){$.value=[];for(const r of s.formList){if(typeof r.source=="function"){const w=await r.source();if(w.code){F.error(w.msg);continue}r.options=w.data}else r.options=r.source;$.value.push(r)}}Q();const x=J;function z(){G.value.clearValidate(),G.value.resetFields(),_.value=!1,x("update:visible",!1)}const i=M({}),G=k();async function W(){if(await G.value.validate())return!1;const w=L=>{if(L){z();return}};_.value?x("update",i,w):x("create",i,w)}const _=k(!1);function X(r){_.value=!0,Object.assign(i,r)}return H({setForm:X}),(r,w)=>{const L=u("a-input"),B=u("a-select"),h=u("a-switch"),m=u("a-radio-group"),P=u("a-textarea"),Y=u("a-form-item"),K=u("a-form"),I=u("a-modal");return l(),c(I,{title:_.value&&r.editLabel?r.editLabel:r.addLabel,visible:s.visible,onCancel:z,"on-before-ok":W},{footer:d(()=>[C(r.$slots,"footer",{form:i})]),default:d(()=>[v(K,{ref_key:"formRef",ref:G,model:i},{default:d(()=>[(l(!0),f(S,null,Z($.value,a=>(l(),f(S,null,[!_.value||_.value&&!a.editDisable?(l(),c(Y,{key:0,field:a.field,label:a.label,rules:a.rules,"validate-trigger":a.validateTrigger},{help:d(()=>[C(r.$slots,`${a.field}_help`,{value:i[a.field]})]),default:d(()=>[a.type==="input"||a.type==="password"?(l(),c(L,{key:0,modelValue:i[a.field],"onUpdate:modelValue":y=>i[a.field]=y,type:a.type==="input"?"text":"password",placeholder:a.label},null,8,["modelValue","onUpdate:modelValue","type","placeholder"])):a.type==="select"?(l(),c(B,{key:1,multiple:a.multiple,modelValue:i[a.field],"onUpdate:modelValue":y=>i[a.field]=y,placeholder:a.label,options:a.options,"allow-clear":""},null,8,["multiple","modelValue","onUpdate:modelValue","placeholder","options"])):a.type==="switch"?(l(),c(h,{key:2,modelValue:i[a.field],"onUpdate:modelValue":y=>i[a.field]=y},null,8,["modelValue","onUpdate:modelValue"])):a.type==="radio"?(l(),c(m,{key:3,modelValue:i[a.field],"onUpdate:modelValue":y=>i[a.field]=y,options:a.options},null,8,["modelValue","onUpdate:modelValue","options"])):a.type==="textarea"?(l(),c(P,{key:4,modelValue:i[a.field],"onUpdate:modelValue":y=>i[a.field]=y,placeholder:a.label,"allow-clear":"","auto-size":a.autoSize},null,8,["modelValue","onUpdate:modelValue","placeholder","auto-size"])):C(r.$slots,a.field,{key:5,form:i})]),_:2},1032,["field","label","rules","validate-trigger"])):g("",!0)],64))),256))]),_:3},8,["model"])]),_:3},8,["title","visible"])}}}),Fe={class:"f_list_com"},Ce={class:"f_list_head"},Le={key:0,class:"action_create"},Be={key:0,class:"action_group"},De={class:"action_search"},Ue={class:"action_filter"},Ae={class:"action_search_slot"},$e={class:"f_list_body"},Ge={class:"f_list_table"},Pe={key:0,class:"col_actions"},Se={key:1},xe={key:0,class:"f_list_page"},ze=te({__name:"f_list",props:{url:{type:Function},columns:{},rowKey:{},noDefaultDelete:{type:Boolean},noAdd:{type:Boolean},noEdit:{type:Boolean},noDelete:{type:Boolean},noBatchDelete:{type:Boolean},searchPlaceholder:{},addLabel:{},editLabel:{},deleteLabel:{},noActionGroup:{type:Boolean},noCheck:{type:Boolean},actionGroup:{},filterGroup:{},noPage:{type:Boolean},limit:{},formList:{},addFormLabel:{},editFormLabel:{},defaultParams:{}},emits:["delete","add","edit","row-click"],setup(q,{expose:H,emit:J}){const s=q,{rowKey:$="id",noDefaultDelete:Q=!1,searchPlaceholder:x="\u641C\u7D22",addLabel:z="\u6DFB\u52A0",editLabel:i="\u7F16\u8F91",deleteLabel:G="\u5220\u9664",limit:W=10}=s,_=k([]);function X(){let e=0;s.noBatchDelete||(_.value.push({label:"\u6279\u91CF\u5220\u9664",value:1,callback:n=>{K(n),R.value=[]}}),e=1),e++;const o=s.actionGroup||[];for(const n of o)_.value.push({label:n.label,value:e,callback:n.callback})}X();const r=k([]);async function w(){r.value=[];for(const e of s.filterGroup||[]){if(typeof e.source=="function"){const o=await e.source(e.params);if(o.code){F.error(o.msg);continue}e.options=o.data}else e.options=e.source;e.callback||(e.callback=o=>{if(e.column){const n={};n[e.column]=o,m(n)}}),r.value.push(e)}}w();const L=k(!1),B=M({list:[],count:0}),h=M({limit:s.noPage?-1:W});async function m(e){s.defaultParams&&Object.assign(h,s.defaultParams),L.value=!0,e&&Object.assign(h,e);const o=await s.url(h);if(L.value=!1,o.code){F.error(o.msg);return}B.list=o.data.list||[],B.count=o.data.count}m();const P=J;async function Y(e){const o=e[$];K([o])}async function K(e){if(Q){P("delete",e);return}const o=/\"(.*?)\"/.exec(s.url.toString());if((o==null?void 0:o.length)!==2)return;const n=o[1],b=await he(n,e);if(b.code){F.error(b.msg);return}m(),F.success(b.msg)}const I=k();function a(e){var o;if((o=s.formList)!=null&&o.length){I.value.setForm(e),T.value=!0;return}P("edit",e)}function y(){var e;if((e=s.formList)!=null&&e.length){T.value=!0;return}P("add")}function ae(){m()}function le(){m()}function ne(){m(),F.success("\u5237\u65B0\u6210\u529F")}const R=k([]),se=M({type:"checkbox",showCheckedAll:!0,onlyCurrent:!1}),j=k();function re(){const e=_.value.find(o=>o.value===j.value);e&&e.callback(R.value)}function ie(e,o){P("row-click",e)}const T=k(!1);async function ue(e,o){const n=/\"(.*?)\"/.exec(s.url.toString());if((n==null?void 0:n.length)!==2)return;const b=n[1],D=await be(b,e);if(D.code){F.error(D.msg);return}m(),o&&o(!0)}async function ce(e,o){const n=/\"(.*?)\"/.exec(s.url.toString());if((n==null?void 0:n.length)!==2)return;const b=n[1],D=await ge(b,e);if(D.code){F.error(D.msg);return}m(),o&&o(!0)}return H({getList:m,data:B}),(e,o)=>{var ee;const n=u("a-button"),b=u("a-select"),D=u("a-input-search"),de=u("icon-refresh"),E=u("a-table-column"),pe=u("a-switch"),fe=u("a-popconfirm"),_e=u("a-table"),me=u("a-pagination"),ye=u("a-spin");return l(),f("div",Fe,[(ee=s.formList)!=null&&ee.length?(l(),c(Ve,{key:0,ref_key:"modalFormRef",ref:I,onCreate:ue,onUpdate:ce,"add-label":s.addFormLabel,"edit-label":s.editFormLabel,visible:T.value,"onUpdate:visible":o[0]||(o[0]=t=>T.value=t),"form-list":s.formList},null,8,["add-label","edit-label","visible","form-list"])):g("",!0),U("div",Ce,[C(e.$slots,"action_add",{},()=>[e.noAdd?g("",!0):(l(),f("div",Le,[v(n,{type:"primary",onClick:y},{default:d(()=>[N(O(A(z)),1)]),_:1})]))]),e.noActionGroup?g("",!0):(l(),f("div",Be,[v(b,{style:{width:"140px"},placeholder:"\u64CD\u4F5C",modelValue:j.value,"onUpdate:modelValue":o[1]||(o[1]=t=>j.value=t),options:_.value},null,8,["modelValue","options"]),j.value?(l(),c(n,{key:0,type:"primary",status:"danger",onClick:re},{default:d(()=>o[5]||(o[5]=[N("\u6267\u884C")])),_:1})):g("",!0)])),U("div",De,[v(D,{placeholder:A(x),modelValue:h.key,"onUpdate:modelValue":o[2]||(o[2]=t=>h.key=t),onSearch:le},null,8,["placeholder","modelValue"])]),U("div",Ue,[(l(!0),f(S,null,Z(r.value,t=>(l(),c(b,{style:ke({width:t.width+"px"}),"allow-clear":"",onChange:t.callback,placeholder:t.label,options:t.options},null,8,["style","onChange","placeholder","options"]))),256))]),U("div",Ae,[C(e.$slots,"search_other")]),U("div",{class:"action_flush",onClick:ne},[v(de)])]),U("div",$e,[v(ye,{loading:L.value,tip:"\u52A0\u8F7D\u4E2D..."},{default:d(()=>[U("div",Ge,[v(_e,{onRowClick:ie,data:B.list,"row-key":A($),selectedKeys:R.value,"onUpdate:selectedKeys":o[3]||(o[3]=t=>R.value=t),"row-selection":s.noCheck?void 0:se,pagination:!1},{columns:d(()=>[(l(!0),f(S,null,Z(s.columns,t=>(l(),f(S,null,[t.dataIndex?(l(),f(S,{key:0},[t.type==="date"?(l(),c(E,V({key:0,ref_for:!0},t),{cell:d(p=>[N(O(A(oe)(p.record[t.dataIndex],t.dateFormat)),1)]),_:2},1040)):t.type==="options"?(l(),c(E,V({key:1,ref_for:!0},t),{cell:d(p=>[v(we,{options:t.options,value:p.record[t.dataIndex]},null,8,["options","value"])]),_:2},1040)):t.type==="switch"?(l(),c(E,V({key:2,ref_for:!0},t),{cell:d(p=>[v(pe,{"model-value":p.record[t.dataIndex]},null,8,["model-value"])]),_:2},1040)):t.dataIndex?(l(),c(E,V({key:3,ref_for:!0},t),null,16)):g("",!0)],64)):(l(),c(E,V({key:1,ref_for:!0},t),{cell:d(p=>[t.slotName==="action"?(l(),f("div",Pe,[C(e.$slots,"action_left",V({ref_for:!0},p)),e.noEdit?g("",!0):(l(),c(n,{key:0,type:"primary",onClick:ve=>a(p.record)},{default:d(()=>[N(O(A(i)),1)]),_:2},1032,["onClick"])),e.noDelete?g("",!0):(l(),c(fe,{key:1,onOk:ve=>Y(p.record),content:"\u786E\u5B9A\u8981\u5220\u9664\u8BE5\u8BB0\u5F55\u5417\uFF1F"},{default:d(()=>[v(n,{type:"primary",status:"danger"},{default:d(()=>[N(O(A(G)),1)]),_:1})]),_:2},1032,["onOk"])),C(e.$slots,"action_right",V({ref_for:!0},p))])):g("",!0),t.slotName==="createdAt"?(l(),f("div",Se,O(A(oe)(p.record[t.slotName],t.dateFormat)),1)):C(e.$slots,t.slotName,V({key:2,ref_for:!0},p))]),_:2},1040))],64))),256))]),_:3},8,["data","row-key","selectedKeys","row-selection"])]),s.noPage?g("",!0):(l(),f("div",xe,[v(me,{"show-total":"",onChange:ae,total:B.count,current:h.page,"onUpdate:current":o[4]||(o[4]=t=>h.page=t),"page-size":h.limit},null,8,["total","current","page-size"])]))]),_:3},8,["loading"])])])}}});export{ze as _};
